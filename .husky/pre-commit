echo "ğŸ” Running pre-commit checks..."

# Check npm package-lock.json consistency
echo "ğŸ“¦ Checking npm package consistency..."
if ! npm ls --depth=0 > /dev/null 2>&1; then
  echo "âŒ Dependencies are out of sync"
  echo "   Run 'npm install' to fix this"
  exit 1
fi

# Run npm audit (check for vulnerabilities - warning only, doesn't block)
echo "ğŸ”’ Running npm audit..."
npm audit --audit-level=high || {
  echo "âš ï¸  npm audit found high/critical vulnerabilities (non-blocking)"
  echo "   Run 'npm audit fix' to attempt automatic fixes"
}

# Run Knip (find unused files, dependencies, exports, etc.)
echo "ğŸ” Running Knip..."
npm run knip || {
  echo "âš ï¸  Knip found unused code/dependencies (non-blocking)"
}

# Run ESLint
echo "ğŸ“ Running ESLint..."
npm run lint

# Run tests
echo "ğŸ§ª Running tests..."
npm run test

echo "âœ… Pre-commit checks passed!"
